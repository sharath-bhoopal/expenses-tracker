import csv
from datetime import datetime
import os

FILE_NAME = "expenses.csv"

def add_expense(amount, category):
    with open(FILE_NAME, "a", newline="") as file:
        writer = csv.writer(file)
        writer.writerow([datetime.now().strftime("%Y-%m-%d"), amount, category])
    print("âœ… Expense added!")

def view_expenses():
    try:
        with open(FILE_NAME, "r") as file:
            reader = list(csv.reader(file))
            if not reader:
                print("No expenses found!")
                return
            print("ID | Date       | Amount | Category")
            print("----------------------------------")
            for idx, row in enumerate(reader, start=1):
                print(f"{idx}  | {row[0]} | {row[1]} | {row[2]}")
    except FileNotFoundError:
        print("No expenses found!")

def delete_expense():
    view_expenses()
    try:
        with open(FILE_NAME, "r") as file:
            expenses = list(csv.reader(file))
        if not expenses:
            return

        exp_id = int(input("\nEnter ID of expense to delete: ")) - 1
        if 0 <= exp_id < len(expenses):
            deleted = expenses.pop(exp_id)
            with open(FILE_NAME, "w", newline="") as file:
                writer = csv.writer(file)
                writer.writerows(expenses)
            print(f"ðŸ—‘ Deleted: {deleted}")
        else:
            print("Invalid ID!")
    except FileNotFoundError:
        print("No expenses found!")

def update_expense():
    view_expenses()
    try:
        with open(FILE_NAME, "r") as file:
            expenses = list(csv.reader(file))
        if not expenses:
            return

        exp_id = int(input("\nEnter ID of expense to update: ")) - 1
        if 0 <= exp_id < len(expenses):
            print(f"Current: {expenses[exp_id]}")
            new_amount = input("Enter new amount (leave blank to keep same): ")
            new_category = input("Enter new category (leave blank to keep same): ")

            if new_amount.strip():
                expenses[exp_id][1] = new_amount
            if new_category.strip():
                expenses[exp_id][2] = new_category

            with open(FILE_NAME, "w", newline="") as file:
                writer = csv.writer(file)
                writer.writerows(expenses)
            print("âœ… Expense updated!")
        else:
            print("Invalid ID!")
    except FileNotFoundError:
        print("No expenses found!")

while True:
    print("\n1. Add Expense\n2. View Expenses\n3. Delete Expense\n4. Update Expense\n5. Exit")
    choice = input("Enter choice: ")

    if choice == "1":
        amt = float(input("Enter amount: "))
        cat = input("Enter category: ")
        add_expense(amt, cat)
    elif choice == "2":
        view_expenses()
    elif choice == "3":
        delete_expense()
    elif choice == "4":
        update_expense()
    elif choice == "5":
        break
    else:
        print("Invalid choice, try again!")